<!-- 
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ include file="../common/header.jspf"%>
<%@ include file="../common/navigation.jspf"%>
<%@ include file="../common/footer.jspf"%>
 -->
<!DOCTYPE html>
<head>
    <title>Project-1</title>
<style>

</style>
<link href="webjars/bootstrap/3.3.6/css/bootstrap.min.css"
	rel="stylesheet" />
    <link  href="proj1style.css" rel="stylesheet" /> 
  <link  href="/favicon.ico" rel="shortcut favicon"  /> 
  <link  href="/project1/favicon.ico" rel="shortcut favicon"  /> 
  <link  href="favicon.ico" rel="shortcut favicon" type="text/html"  /> 
  <!-- /project1/src/main/webapp/favicon.ico
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
   -->
</head>
<body onload="sessionInfo();listRequest()"><!-- getUser(); -->
    <nav class="navbar navbar-default">
        <ul class="nav navbar-nav navleft">
            <li> <a href="#" class="navbar-brand center"><em>Project-1</em>
                </a>  </li>
            <li class="active"> <a href="/project1/index.html">HOME</a></li>
            <li><a href="/project1/viewer.html">VIEWER</a></li>
            <li><a href="/project1/request.html">NEW REQUEST</a>  </li >
        </ul>

        <ul class="nav navbar-nav navbar-right userdata">
            <li class="user navright">
            <span>User</span> <span class="id" id="headerId"></span><br />
            <span>ID</span> <span  class="id" id="userId"></span><br />
            <span>Dept</span> <span class="id" id="userDept"></span><br /> 
            <span>Super</span> <span  class="id" id="userSuper"></span><br />
 
            <span  ><a class="logout" onclick="logout()" href="/project1/login.html">Sign Out</a></span>
        </li>
        </ul>
    </nav>
   <div class="container">    
    <h3>DASHBOARD</h3> 
   <div id="info" class="row">
   
<div class="col col-xs-8">
<h4>Pending Requests</h4>
<hr>
    <table id="table">  
        <tr>
            <td>| </td>
            <td id="dname">|</td>
        </tr> 
        <tr>
            <td>| </td>
            <td id="dtype">|</td>
        </tr>
        <tr>
            <td>| </td>
            <td id="did">|</td>
        </tr>  
    </table>   
   
</div>
<div class="col col-xs-4">
<div style="height:200px;"> 
<input placeholder="search id # ..."  min="100" size="10px" id="taskId" type="number">  
<button class="btn btn-primary" onclick="getRequestk()"> Request Details </button>     
<hr>
<div id="get-request">
</div>
</div>
     <h4 id="text">Task Number</h4>
    <input id="taskId" type="number">
    <h4 id="text">curr UserId</h4>
    <input id="currUserId" type="number">
    <h4 id="text">time Stamp</h4>
    <input id="timeStamp" type="text"> 
    <button class="btn btn-primary" onclick="addTask()">Add</button>
 
 </div> 

    </div> 
    </div><!-- end of container -->
    
    <footer class="footer"> 
   <div>
    <p>Project 1 Footer - Revature<br />
    <small>Copyright &copy; 2020 &nbsp;</small></p>
   </div>
</footer>
</body>
    <script src="proj1js.js"></script>
<script> 
// GET BY ID
let getTask = function () {   
	let reqId = document.getElementById("reqId").value;
	console.log("reqId "+reqId)
	let xhttp = new XMLHttpRequest();
    
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            let d = JSON.parse(this.responseText);
            console.log("name: "+d.currUserId+ " length: "+this.responseText ); 
           if (d.taskId != null)  { 
            	let infoContent  = `  
            	<div class="row">
            	<div class="col col-xs-6">
            	    <h6>Time Stamp: ${d.timeStamp}</h6> 
                	<h6>Reference Id: ${d.taskId}</h6>
              		<h6>Request ID: #${d.reqId}</h6>
				 	<h6>Updated by User: #${d.currUserId}</h6> 
				 	<h6>currDocs: ${d.currDocs}</h6> 
				 	<h6>update Req Type: ${d.updateReqType}</h6> 
			 	</div>
            	<div class="col col-xs-6">
                	<h6>update Reason: ${d.updateReason}</h6> 
				 	<h6>update Amount Granted: ${d.updateAmt}</h6> 
				 	<h6>update Reason: ${d.updateReason}</h6> 
				 	<h6>update Grade Pass: ${d.updateGradePass}</h6> 
				 	<h6>update Stage: ${d.updateStage}</h6> 

			 	</div>
            	</div>
              `;
              
             	let info =  document.getElementById("get-request"); 
	            info.innerHTML = infoContent;
            } else { 
                 	let infoContent = ` Oops! Id #${reqId} not found, try another!`; 
                     let info =  document.getElementById("get-request"); 
                     info.innerHTML = infoContent;
                 } 
            }

        } 
    xhttp.open("GET", "http://localhost:8090/project1/getTask.do?taskId=" + taskId, true); 
    xhttp.send(); 
    }  


let listRequest = function() {
	 
	let xhttp = new XMLHttpRequest(); 
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 &&  this.status ==   200 ) {  
			
        	let d = JSON.parse(this.responseText);
    		console.log(d);
    		if ( d =="undefined" || d.length==0 || !d  || d == null ) {
				document.getElementById("table").innerHTML += `
				<h6>No Reimbursements have been requested.</h6>
				`;
			} else {
			 document.getElementById("table").innerHTML =""; //erase empty list
		
				for (i = 0; i<d.length; i++) {
					document.getElementById("table").innerHTML += `
				        <tr>
			            <td><strong>#${d[i].reqId}</strong>&nbsp;   &nbsp; Request:</td>
			            <td >${d[i].reqName}</td>
				        </tr> 
				        <tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Request Type:</td>
			            <td>${d[i].reqType}</td>
				        </tr>
				        <tr>
				        <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp;Date Requested:</td>
				        <td>${d[i].reqDatetime}</td>
			        	</tr>
				        <tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Request Amount:</td>
			            <td>${d[i].reqAmt}</td>
			        	</tr>
		        	   	<tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Adjusted Amount:</td>
			            <td>${d[i].reqAmt}</td>
			        	</tr>
		        		<tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Status:</td>
			            <td>${d[i].stage}</td>
			        	</tr>
				        <hr>				      
					`; 
					}
			} 
	 	}
    }
    let uid = getCookie("userid"); 
    xhttp.open("GET", "http://localhost:8090/project1/listRequest.do?userId="+uid, true); 
    xhttp.send(); 
     
    /* DETAILS: 
    <tr>
    <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Request Description:</td>
    <td>${d[i].reqDesc}</td>
	</tr>
	*/
}	 

    let addTask = function () {
        let d = document.getElementById("taskId");
        let taskId = ""; // declare & erase subsequent
        taskId += d.value; // append

        let dn = document.getElementById("currUserId");
        let currUserId;  // just declare
        currUserId = dn.value; // overwrite

        let dt = document.getElementById("timeStamp");
        let timeStamp;
        timeStamp = dt.value;

        let xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

                console.log("readyState: " + this.readyState + ", status: " + this.status);
            }
        }

        xhttp.open("POST", "http://localhost:8090/project1/addTask.do", true);

        xhttp.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        xhttp.send("taskId=" + taskId + "&currUserId=" + currUserId + "&timeStamp=" + timeStamp);
        console.log("Great, you sent taskId: #" + taskId + " submitted by: *" + currUserId + " on date: *" + timeStamp);


    }

</script>

	<script src="webjars/jquery/1.9.1/jquery.min.js"></script>
	<script src="webjars/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</HTML>