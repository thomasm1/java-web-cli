<!DOCTYPE html>

<head>
    <title>Project-1</title>
<link href="webjars/bootstrap/3.3.6/css/bootstrap.min.css"
	rel="stylesheet">
    <link  href="proj1style.css" rel="stylesheet" /> 
 
  <link rel="shortcut favicon"  href="favicon.ico"  /> 
  
<style>   
    .detail { 
    background-color: lightblue;
    border:solid 1px blue;
    border-radius: 5px;
    padding: 15px;
    margin:10px;
    width:100%;
    height:250px;
    }
    .table {
    background-color:lightblue;
    border:solid 1px blue;
    padding:15px;
    margin:10px;
    max-height:600px;
    overflow-y:scroll;
    }
    tr,
    th,
    td {
        background-color: aliceblue; 
        padding: 15px;
        margin: 10px;
        border:solid 1px blue;
    }
    td {
        color:blue;
        width:400px;
    }  
    td:first-child { 
        width:220px;
    }  
     /* overrides */
    #info {				
        height:150px;
        padding: 5px; 
    } 
    
</style>

  <link rel="shortcut favicon"  href="favicon.ico"  /> 

</head>
<body  >
	<nav class="navbar navbar-default"> 
		<ul class="nav navbar-nav ">
		<li>	
		<a href="#" class="navbar-brand center"><em>Project-1</em>
		</a>
	</li>  
			<li><a href="/project1/index.html">HOME</a></li>
			<li class="active"><a href="/project1/viewer.html">VIEWER</a></li> 
			<li><a href="/project1/request.html">NEW REQUEST</a></li> 
		</ul>

		<ul class="nav navbar-nav navbar-right log">
			<li><a href="/project1/login.html">Sign Out</a></li>
		</ul> 
	</nav> 
<div class="container"> 
   <h3>TABLE VIEWER</h3>  
   	<div class="detail">
  <button class="btn btn-primary" onclick="getTask()">Get Task by Reference ID </button>     
   <input placeholder="search id # ..."  min="0" size="10px" id="taskId" type="number">  
	<div id="get-task"></div>
     </div> 
    <div class="table">
    <button class="btn btn-primary" onclick="listTask()"> Get Tasks
    </button>  
    <button class="btn btn-primary" onclick="listDept()"> Get Departments
    </button>  
     <button class="btn btn-primary" onclick="listUser()"> Get Users
    </button>  
     <button class="btn btn-primary" onclick="listRequest()"> Get Requests
    </button>  
   <hr>
   <table id="table">  
        <tr>
            <td>| </td>
            <td id="dname">|</td>
        </tr> 
        <tr>
            <td>| </td>
            <td id="dtype">|</td>
        </tr>
        <tr>
            <td>| </td>
            <td id="did">|</td>
        </tr>  
    </table>   

    </div> <!-- end of div.table  -->
    </div> <!-- end of container -->
    <footer class="footer"> 
   <div>
    <p>Project 1 Footer - Revature<br />
    <small>Copyright &copy; 2020 &nbsp;</small></p>
   </div>
</footer>
</body>
<script>  
	// GET BY ID
    let getTask = function () {   
		let taskId = document.getElementById("taskId").value;
		console.log("taskId "+taskId)
    	let xhttp = new XMLHttpRequest();
        
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                let d = JSON.parse(this.responseText);
                console.log("name: "+d.currUserId+ " length: "+this.responseText ); 
               if (d.taskId != null)  { 
                	let infoContent  = `  
                	<div class="row">
                	<div class="col col-xs-6">
                	    <h6>Time Stamp: ${d.timeStamp}</h6> 
	                	<h6>Reference Id: ${d.taskId}</h6>
	              		<h6>Request ID: #${d.reqId}</h6>
					 	<h6>Updated by User: #${d.currUserId}</h6> 
					 	<h6>currDocs: ${d.currDocs}</h6> 
					 	<h6>update Req Type: ${d.updateReqType}</h6> 
				 	</div>
                	<div class="col col-xs-6">
	                	<h6>update Reason: ${d.updateReason}</h6> 
					 	<h6>update Amount Granted: ${d.updateAmt}</h6> 
					 	<h6>update Reason: ${d.updateReason}</h6> 
					 	<h6>update Grade Pass: ${d.updateGradePass}</h6> 
					 	<h6>update Stage: ${d.updateStage}</h6> 
	
				 	</div>
                	</div>
                  `;
                  
                 	let info =  document.getElementById("get-task"); 
		            info.innerHTML = infoContent;
                } else { 
                     	let infoContent = ` Oops! Id #${taskId} not found, try another!`; 
                         let info =  document.getElementById("get-task"); 
                         info.innerHTML = infoContent;
                     } 
                }
 
            } 
        xhttp.open("GET", "http://localhost:8090/project1/getTask.do?taskId=" + taskId, true); 
        xhttp.send(); 
        }  
    // TABLE LISTS 
    let listTask = function() {
		console.log("clicked list");
		let xhttp = new XMLHttpRequest(); 
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 &&  this.status ==   200 ) {  
        		let d = JSON.parse(this.responseText);
        		console.log(d);
				 document.getElementById("table").innerHTML =""; //erase empty list
				for (i = 0; i<d.length; i++) {
				document.getElementById("table").innerHTML += `
			        <tr>
			            <td><strong>#${d[i].taskId}</strong> &nbsp; Task TimeStamp:</td>
			            <td >${d[i].timeStamp}</td>
			        </tr> 
			        <tr>
			            <td>&nbsp;  &nbsp;  &nbsp; &nbsp;  Changed By:</td>
			            <td>#${d[i].currUserId}</td>
			        </tr>
			        <hr>				      
				`; 
				}
		 	}
        }
        xhttp.open("GET", "http://localhost:8090/project1/listTask.do", true); 
        xhttp.send(); 
	}	 
    let listDept = function() {
		console.log("clicked list");
		let xhttp = new XMLHttpRequest(); 
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 &&  this.status ==   200 ) {  
        		let d = JSON.parse(this.responseText);
        		console.log(d);
				 document.getElementById("table").innerHTML =""; //erase empty list
				for (i = 0; i<d.length; i++) {
				document.getElementById("table").innerHTML += `
			        <tr>
			            <td><strong>#${d[i].deptId}</strong>&nbsp;   &nbsp; Dept Name:</td>
			            <td >${d[i].deptName}</td>
			        </tr> 
			        <tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Dept. Head:</td>
			            <td>#${d[i].deptHeadId}</td>
			        </tr>
			        <hr>				      
				`; 
				}
		 	}
        }
        xhttp.open("GET", "http://localhost:8090/project1/listDept.do", true); 
        xhttp.send(); 
	}	 
    let listUser = function() {
		console.log("clicked list");
		let xhttp = new XMLHttpRequest(); 
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 &&  this.status ==   200 ) {  
        		let d = JSON.parse(this.responseText);
        		console.log(d);
				 document.getElementById("table").innerHTML =""; //erase empty list
				for (i = 0; i<d.length; i++) {
				document.getElementById("table").innerHTML += `
			        <tr>
			            <td><strong>#${d[i].userId}</strong>&nbsp;   &nbsp; Name:</td>
			            <td >${d[i].userName}</td>
			        </tr> 
			        <tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Supervisor ID:</td>
			            <td>#${d[i].superId}</td>
			        </tr>
			        <hr>				      
				`; 
				}
		 	}
        }
        xhttp.open("GET", "http://localhost:8090/project1/listUser.do", true); 
        xhttp.send(); 
	}	  
    let listRequest = function() {
		console.log("clicked list");
		let xhttp = new XMLHttpRequest(); 
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 &&  this.status ==   200 ) {  
        		let d = JSON.parse(this.responseText);
        		console.log(d);
				 document.getElementById("table").innerHTML =""; //erase empty list
				for (i = 0; i<d.length; i++) {
				document.getElementById("table").innerHTML += `
			        <tr>
			            <td><strong>#${d[i].reqId}</strong>&nbsp;   &nbsp; Request:</td>
			            <td >${d[i].reqName}</td>
			        </tr> 
			        <tr>
			            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Request Type:</td>
			            <td>${d[i].reqType}</td>
			        </tr>
			        <tr>
		            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Request Description:</td>
		            <td>${d[i].reqDesc}</td>
		        	</tr>
			        <tr>
		            <td>&nbsp;&nbsp;  &nbsp;  &nbsp; &nbsp; Request Amount:</td>
		            <td>$${d[i].reqAmt}</td>
		        	</tr>
			        <hr>				      
				`; 
				}
		 	}
        }
        xhttp.open("GET", "http://localhost:8090/project1/listRequest.do", true); 
        xhttp.send(); 
	}	 
</script> 
	<script src="webjars/jquery/1.9.1/jquery.min.js"></script>
	<script src="webjars/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</HTML>